---
title: "Tutorial 1"
author: "andy south"
date: "`r Sys.Date()`"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Vignette Title}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---


This tutorial will be about you doing stuff. I will get you to try things probably before you understand fully what they are. Worry not.
1.  It doesn't matter if you make mistakes.
1.  We will come back to some of the concepts later.
1.  Questions are encouraged.
1.  This should at least give you a start to follow up on later.

The beauty (& sometimes otherwise) of R is that there are usually multiple ways of doing the same thing. Here I will show one way, this will help you learn some concepts but you may well find that alternatives are better suited to your needs.


### Install the R package for the course

```{r eval=FALSE, tidy=FALSE}
#first install devtools to enable install from GitHub 
install.packages("devtools")
library(devtools)
install_github('AndySouth/rmapteach')
```

Load the R package for the course
```{r eval=TRUE}
library("rmapteach")
```

Install and load the tmap package
```{r eval=FALSE}
install.packages("tmap")
```

```{r eval=TRUE}
library("tmap")
```

### 1.1 Getting started with polygon maps
```{r eval=TRUE}

# load data from tmap
data(Europe)
# set shapes and fill them
tm_shape(Europe) +
  tm_fill("purple")

# load data from tmap
data(World)
# set shapes and fill them
tm_shape(World) +
  tm_fill("green")

# check what data are associated with a map using 'str(*@data)', str stands for structure
str(World@data)
str(Europe@data)
# note that str(Europe) shows all the geometry information too and is not very useful here

# check the contents of Factor variables using 'levels'
levels(Europe$part)
# levels(Europe@data$part) gives the same output, you don't always need the @data to get at the variables 

# plot a subset of the map using '[which(*),]'
tm_shape(Europe[which(Europe$part=='Northern Europe'),]) +
  tm_fill("red")


# check the contents of numeric variables using 'hist'
hist(Europe$pop_est)

# fill polygons on a map based on data variables
# factor
tm_shape(Europe) +
  tm_fill("part")
# numeric
tm_shape(Europe) +
  tm_fill("pop_est")

# the previous commands used default colours, you can modify these with 'palette'
tm_shape(Europe) +
  tm_fill("pop_est", palette = "YlGnBu")
# to see available palettes 
RColorBrewer::display.brewer.all()

# to add a histogram to the legend
tm_shape(Europe) +
  tm_fill("pop_est", palette = "YlGnBu", legend.hist = TRUE)
  

```

### 1.2 Now experiment with code from the previous section to map different things
e.g. can you plot different areas, different variables, different colours ...

```{r eval=TRUE}
# to see help use '?'
?tm_fill

```



### 1.3 Explaining some details used in section 1
syntax like ggplot2 (e.g. + to add layers)

SpatialPolygonsDataFrames
sp
class()


### 2.1 Getting started with point maps
```{r eval=TRUE}

# load some tmap point data for metropolitan areas
data(metro)
# ?metro gives information about the data
# this is also an sp object with associated variables
class(metro)
str(metro@data)

# plot points as bubbles
tm_shape(metro) +
    tm_bubbles("pop2010", legend.size.show = FALSE)

# plot points on top of a European map
tm_shape(Europe) +
  tm_borders() +
tm_shape(metro) + 
  tm_bubbles("pop2010")

```

### 2.2 Experimenting with point maps


### 2.3 ?new concepts in point maps


### 3.1 Getting started with raster maps

```{r eval=TRUE}

data(land)

class(land)

#aha! land is actually a sgdf
#[1] "SpatialGridDataFrame"
#attr(,"package")
#[1] "sp"

str(land@data)

tm_shape(land) + 
    tm_raster("trees", breaks=seq(0, 100, by=20) )

tm_shape(land) + 
    tm_raster("trees", breaks=seq(0, 100, by=50) )

# categorical land cover
tm_shape(land) + 
    tm_raster("cover")

# using faceting

# facet by cover to get one map for each cover type
tm_shape(land) + 
    tm_raster("cover", legend.show = FALSE) +
    tm_facets("cover", free.coords=TRUE, drop.units=TRUE)   


# facet by country to get one cover map per country
tm_shape(land) + 
    tm_raster("cover") + # , legend.show = FALSE)
tm_shape(Europe[which(Europe$part=="Northern Europe"),]) +
    tm_borders() +
    tm_facets("name", free.coords = TRUE)





```


### 3.2 Experimenting with raster maps


### 4 Using your own data
You can use both your own geometry and/or attribute data in tmap and other mapping options.

```{r eval=TRUE}

# create a very simple data frame as an example
dF <- data.frame( country=c("Spain", "United Kingdom"),
                  weather=c("hot", "cold") )

# tmap can join this onto a map (other options are available too)
Eu_and_dat <- append_data(Europe, dF, key.shp="name", key.data="country")

tm_shape(Eu_and_dat) +
  tm_fill("weather", palette=c("red","blue"))

# Can you plot some other data by country ?
# remember the country names in the map are in Europe$name
# I could maybe give example with data from gapmindr or worldbank packages


```


### 5 Interactivity (with leaflet &/or tmap)


### 6 Putting it all together or experiment with anything
```{r eval=TRUE}
# to list datasets in the tmap package
data(package="tmap")

# list data in raster package
data(package="raster")

```



###TODO
~ where to add facetting in ?
~ acknowledge Martijn
~ say I wrote an older package to do this kind of thing but tmap is newer & better (in almost all respects)


